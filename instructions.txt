
===============================
     VM instructions
===============================

;; To compile the virtual machine we first need to install a few packages, namely:

- MPI (with MPICXX)
- Boost (must include boost-thread, boost-system-mt, boost-date-time-mt, boost-regex-mt, boost-serialization-mt and boost-mpi-mt)

;; Use your operating system facilities to install such packages.

;; on my (seth's) ubuntu (64-bit) system:
;;  sudo apt-get install mpi-default-dev
;;  sudo apt-get install libboost-all-dev
;; 
;; Now, we'll download the virtual machine source code:
$ git clone https://github.com/flavioc/meld.git

;; Let's compile the virtual machine:
$ cd meld
$ make

;; To run a program
$ ./meld -f <byte code file> -c sched

;; Where sched is either sl, th or thp
;; Both tl and tlp need the number of threads, thus to use 4 threads with tl you do:
$ ./meld -f file.m -c tl4

;; To measure execution time, add -t to the command line.
;; To see the final contents of the database, add -d or -s

===============================
     Compiler instructions
===============================

;; First and foremost, install sbcl using the operating systems facilities
;; On my mac, I use brew install sbcl.

;; Now download quicklisp, an utility for installing Lisp packages.
curl -O http://beta.quicklisp.org/quicklisp.lisp

;; Now let's install all the required sbcl packages, load sbcl by typing:
$ sbcl

;; Type the following instructions into SBCL, one by one:

(require 'asdf)
(load "quicklisp")
(quicklisp-quickstart:install)
(ql:quickload "cl-ppcre")
(ql:quickload "yacc")
(ql:quickload "cl-lex")
(ql:quickload "arnesi")
(ql:quickload "alexandria")
(ql:quickload "flexi-streams")
(ql:quickload "ieee-floats")
(ql:add-to-init-file)

;; Now it's time to download cl-meld:
$ cd ~/quicklisp/local-projects
$ git clone https://github.com/flavioc/cl-meld.git

;; Before you can load up the compiler, you need to patch CL-Yacc so that it supports comments in the source code:

$ cd ~/quicklisp/dists/quicklisp/software/cl-yacc-<version>
$ patch -p0 < ~/cl-meld/yacc-comments.patch
$ sbcl

;; Run on the lisp interpreter:
(ql:quickload "cl-meld")
;; To compile a file, just do this:
(cl-meld:meld-compile "path-to-file.meld" "path-to-output-file")

;; If everything went ok you should see "All done. T"
